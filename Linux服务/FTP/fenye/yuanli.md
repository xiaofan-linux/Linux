#VSFTP原理
#### 1.VSFTP连接类型
```
控制连接（持续连接）——————>TCP21（命令信道）——————>用户收发FTP命令
数据连接（按需连接）——————>TCP20（数据信道）——————>用于上传下载数据
```
#### 2.VSFTP工作模式
##### FTP传输模式分为主动模式和被动模式

######主动模式原理图
![](/FTP/image/1.png)
######主动模式详细原理解释
```
主动模式：
    服务端从20端口主动向客户端发起连接主动模式过程：（FTP默认主动模式）服务端从20端口主动向客户端发起连接  
    1.FTP客户端连接FTP服务器的21端口发送用户名和密码  
    2.FTP服务端接收到用户名和密码验证用户名和密码，验证通过返回登录成功，验证不通过，拒绝登录  
    3.客户端会随机开启一个端口（1024以上）发送PORT命令到FTP服务器，告诉服务器客户端采用主动模式，并开启了随机端口  
    4.FTP服务器接收到PORT主动模式命令和随机端口  
    5.通过FTP服务器的20端口和客户端的随机端口连接，传输数据
```
###### 被动模式流程图
![](/FTP/image/2.png)
###### 被动模式详细原理解释
```
被动模式过程：服务端在指定范围内某个端口被动等待客户端连接  
    1.FTP客户端连接FTP服务器的21端口发送用户名和密码  
    2.FTP服务端接收到用户名和密码验证用户名和密码，验证通过返回登录成功验证不通过，拒绝登录  
    3.发送PASV命令，告诉服务端采用被动模式  
    4.服务端接收到PASV命令，随机开启一个端口（1024以上），并把随机端口返回给客户端     
    5.客户端通过连接服务端的随机端口进行数据传输
```
```
    FTP连接端口（主动模式）    
        控制连接：TCP 21，用于发送FTP命令信息    
        数据连接：TCP 20，用于上传、下载数据
    FTP连接端口（被动模式）    
        控制连接：TCP 21，用于发送FTP命令信息    
        数据连接：随机端口（1024以上），用于上传、下载数据
```
